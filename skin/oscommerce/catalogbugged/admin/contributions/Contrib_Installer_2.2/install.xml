<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contrib>
  <description>
    <details contrib_ref="3286" forum_ref="156667" contrib_type="Other" status="0" last_update="2005-11-03"/>
    <comments><![CDATA[Contrib Installer]]></comments>
    <credits><![CDATA[
    Rinon (culda_rinon at hotmail.com)
    Vlad Savitsky (vlad at solti.com.ua)
    Imrich Scindler (ischindl at progis.sk)
    ]]></credits>
    <ident>CONTRIB_INSTALLER</ident>
    <version>2.2</version>
    <post_install_notes>God bless you, man!</post_install_notes>
  </description>


  <addlangdef>
	<lang type="admin" lng="english" name="BOX_HEADING_CONTRIB_INSTALLER">Contrib Installer</lang>
	<lang type="admin" lng="english" name="BOX_CONTRIB_INSTALLER_CREATE_CIP">Create CIP</lang>
	<lang type="admin" lng="english" name="BOX_CONTRIB_INSTALLER_UPLOAD_CIP">Upload CIP</lang>
	<lang type="admin" lng="english" name="BOX_CONTRIB_INSTALLER_CIP_MANAGER">CIP Manager</lang>
	<lang type="admin" lng="english" name="BOX_CONTRIB_INSTALLER_UPDATE">Update Installer</lang>
	<lang type="admin" lng="english" name="BOX_CONTRIB_INSTALLER_SEARCH_CIP">Search CIP</lang>
	<lang type="admin" lng="english" name="ERROR_FILE_SIZE_NOT_ALLOWED">Error: File size must be not more than </lang>
  </addlangdef>
<!-- b BOX-->
    <add2end>
        <file name="admin/includes/column_left.php" />
        <add type="php"><![CDATA[require((defined('JOSCOM_VERSION') ? DIR_FS_ADMIN_BOXES : DIR_WS_BOXES) . 'contrib_installer.php');]]></add>
    </add2end>
<!-- e BOX-->

  <createtable>
    <table name="cip"><![CDATA[
(
            `cip_id` int(11) NOT NULL auto_increment PRIMARY KEY,
            `cip_folder_name` varchar(255) NOT NULL,
            `cip_installed` int(1) DEFAULT '0' NOT NULL,
            `cip_ident` varchar(255) NOT NULL,
            `cip_version` varchar(255) NOT NULL
        );
        ]]></table>
  </createtable>

  <createtable>
    <table name="cip_depend"><![CDATA[
(
            `cip_ident` varchar(255) NOT NULL,
            `cip_ident_req` varchar(255) NOT NULL,
            `cip_req_type` int(2) NOT NULL,
            PRIMARY KEY  (`cip_ident`(100),`cip_ident_req`(100),`cip_req_type`)
        );
        ]]></table>
  </createtable>

  <modifytable>
  	<table name="configuration_group"/>
  	<column name="configuration_group_key" action="addcol">VARCHAR( 64 ) NOT NULL</column>
  </modifytable>

<sql>
<query><![CDATA[
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_MY_SHOP" where configuration_group_id=1;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_MINIMAL_VALUES" where configuration_group_id=2;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_MAXIMAL_VALUES" where configuration_group_id=3;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_PICTURES_PARAMETERS" where configuration_group_id=4;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_CUSTOMERS" where configuration_group_id=5;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_MODULES" where configuration_group_id=6;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_SHIPPING" where configuration_group_id=7;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_PRODUCTS" where configuration_group_id=8;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_WAREHOUSE" where configuration_group_id=9;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_LOGGING" where configuration_group_id=10;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_CACHE" where configuration_group_id=11;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_EMAIL" where configuration_group_id=12;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_DOWNLOAD" where configuration_group_id=13;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_GZIP" where configuration_group_id=14;
	update %DB_PREFIX%configuration_group set configuration_group_key="CG_SESSIONS" where configuration_group_id=15;
]]></query>
</sql>

<config_group>
	<key>CG_CIP_MANAGER</key>
	<title>Contrib Installer</title>
	<descr>Configuration for the Contrib Installer</descr>
	<visible>1</visible>
</config_group>

<config>
	<group_key>CG_CIP_MANAGER</group_key>
	<key>DIR_FS_CIP</key>
	<title>Contribution Directory</title>
	<value type="php"><![CDATA[$_REQUEST['contrib_dir'];]]></value>
	<descr>Location of contribution files</descr>
	<sort_order>5</sort_order>
</config>
<config>
	<group_key>CG_CIP_MANAGER</group_key>
	<key>ALLOW_SQL_BACKUP</key>
	<title>Backup Database Before Install Each CIP</title>
	<value>true</value>
	<descr><![CDATA[Choose TRUE and database will be backuped before each CIP install.<br><b>CIP.NET.UA Advise</b>:<br>Do backup if database isn\'t huge or for debugging.]]></descr>
	<sort_order>10</sort_order>
	<set_function><![CDATA[tep_cfg_select_option(array(\'true\', \'false\'), ]]></set_function>
</config>
<config>
	<group_key>CG_CIP_MANAGER</group_key>
	<key>ALLOW_SQL_RESTORE</key>
	<title>Restore Database When Remove Each CIP</title>
	<value>false</value>
	<descr><![CDATA[Choose TRUE and files will be restored from backup.
                <br><b>CIP.NET.UA Advise</b>:<br>Backup doesn\'t contain changes made after CIP installation.<br>Use restoring only when build a new store or debug.]]></descr>
	<sort_order>20</sort_order>
	<set_function><![CDATA[tep_cfg_select_option(array(\'true\', \'false\'), ]]></set_function>
</config>
<config>
	<group_key>CG_CIP_MANAGER</group_key>
	<key>ALLOW_FILES_BACKUP</key>
	<title>Backup Files Before Install Each CIP</title>
	<value>true</value>
	<descr><![CDATA[Choose TRUE and files will be backuped.<br>Backup contain only files which CIP will modify.<br><b>CIP.NET.UA Advise</b>:<br>We recommend to do a files backup.]]></descr>
	<sort_order>15</sort_order>
	<set_function><![CDATA[tep_cfg_select_option(array(\'true\', \'false\'), ]]></set_function>
</config>
<config>
	<group_key>CG_CIP_MANAGER</group_key>
	<key>ALLOW_FILES_RESTORE</key>
	<title>Restore Files When Remove Each CIP</title>
	<value>false</value>
	<descr><![CDATA[Choose TRUE and files will be restored from backup.
                <br><b>CIP.NET.UA Advise</b>:<br>Backup doesn\'t contain changes made after CIP installation.<br>Use restoring only when build a new store or debug.]]></descr>
	<sort_order>25</sort_order>
	<set_function><![CDATA[tep_cfg_select_option(array(\'true\', \'false\'), ]]></set_function>
</config>
<config>
	<group_key>CG_CIP_MANAGER</group_key>
	<key>ALLOW_OVERWRITE_MODIFIED</key>
	<title>Allow Overwrite Existing Modified Files</title>
	<value>false</value>
	<descr><![CDATA[Choose TRUE and ADDFILE will overwrite even files with changes.<br><b>CIP.NET.UA Advise</b>:<br>All changes will be lost. Use only for testing and debugging.]]></descr>
	<sort_order>30</sort_order>
	<set_function><![CDATA[tep_cfg_select_option(array(\'true\', \'false\'), ]]></set_function>
</config>
<config>
	<group_key>CG_CIP_MANAGER</group_key>
	<key>TEXT_LINK_FORUM</key>
	<title>Forum Link</title>
	<value><![CDATA[http://forums.oscommerce.com/index.php?showtopic=]]></value>
	<descr><![CDATA[URL for support forum at osCommerce.org]]></descr>
	<sort_order>50</sort_order>
</config>
<config>
	<group_key>CG_CIP_MANAGER</group_key>
	<key>TEXT_LINK_CONTR</key>
	<title>URL to the Contribution\'s page</title>
	<value><![CDATA[http://www.oscommerce.com/community/contributions,]]></value>
	<descr><![CDATA[URL for contrib\'s page at osCommerce.org]]></descr>
	<sort_order>130</sort_order>
</config>
<config>
	<group_key>CG_CIP_MANAGER</group_key>
	<key>ALWAYS_DISPLAY_REMOVE_BUTTON</key>
	<title>Always Display Remove-Button</title>
	<value>false</value>
	<descr><![CDATA[Choose TRUE and REMOVE button will be displayed for both installed and NOT installed CIPs.]]></descr>
	<sort_order>30</sort_order>
	<set_function><![CDATA[tep_cfg_select_option(array(\'true\', \'false\'), ]]></set_function>
</config>
<config>
	<group_key>CG_CIP_MANAGER</group_key>
	<key>ALWAYS_DISPLAY_INSTALL_BUTTON</key>
	<title>Always Display Install-Button</title>
	<value>false</value>
	<descr><![CDATA[Choose TRUE and INSTALL button will be displayed for both installed and NOT installed CIPs.]]></descr>
	<sort_order>30</sort_order>
	<set_function><![CDATA[tep_cfg_select_option(array(\'true\', \'false\'), ]]></set_function>
</config>

<config>
	<group_key>CG_CIP_MANAGER</group_key>
	<key>SHOW_SIZE_COLUMN</key>
	<title>Show Size Column</title>
	<value>false</value>
	<descr><![CDATA[Choose TRUE and Size column will be shown.]]></descr>
	<sort_order>300</sort_order>
	<set_function><![CDATA[tep_cfg_select_option(array(\'true\', \'false\'), ]]></set_function>
</config>

<config>
  <group_key>CG_CIP_MANAGER</group_key>
  <key>SHOW_PACK_BUTTONS</key>
  <title>Show Pack and Unpack Buttons</title>
  <value>false</value>
  <descr><![CDATA[Choose TRUE and Pack and Unpack Buttons will be shown.]]></descr>
  <sort_order>300</sort_order>
  <set_function><![CDATA[tep_cfg_select_option(array(\'true\', \'false\'), ]]></set_function>
</config>

<config>
  <group_key>CG_CIP_MANAGER</group_key>
  <key>USE_LOG_SYSTEM</key>
  <title>Use Log System</title>
  <value>false</value>
  <descr><![CDATA[Choose TRUE and all actions will be logged into file in backups folder.]]></descr>
  <sort_order>300</sort_order>
  <set_function><![CDATA[tep_cfg_select_option(array(\'true\', \'false\'), ]]></set_function>
</config>

<config>
  <group_key>CG_CIP_MANAGER</group_key>
  <key>MAX_UPLOADED_FILESIZE</key>
  <title>Maximum filesize for uploaded CIP</title>
  <value>524288</value>
  <descr><![CDATA[Set maximum filesize in bytes for files that can be uploaded on server.]]></descr>
  <sort_order>310</sort_order>
</config>



  <addfilename>
    <file name="FILENAME_CIP_MANAGER" type="admin">cip_manager.php</file>
  </addfilename>


<!-- b on index.php -->
    <findreplace>
        <file name="admin/index.php" />
        <originallinenumbers start="56" end="56" />
        <find><![CDATA[array('title' => TOOLS_FILES, 'link' => tep_href_link(FILENAME_FILE_MANAGER, 'selected_box=tools')))));
]]></find>
        <replace type="php"><![CDATA[
                                         array('title' => TOOLS_FILES, 'link' => tep_href_link(FILENAME_FILE_MANAGER, 'selected_box=tools')))),
                array(
                    'title' =>BOX_HEADING_CONTRIB_INSTALLER,
                    'image' => 'contrib_installer.png',
                    'href' => tep_href_link(FILENAME_CIP_MANAGER, 'selected_box=contrib_installer'),
                    'children' =>
                        array(
                             array('title' =>BOX_CONTRIB_INSTALLER_CIP_MANAGER,
                                        'link' => tep_href_link(FILENAME_CIP_MANAGER, 'selected_box=contrib_installer')
                             ),
                            array('title' =>BOX_CONTRIB_INSTALLER_UPLOAD_CIP,
                                        'link' =>tep_href_link(FILENAME_CIP_MANAGER, 'action=upload&goto='.DIR_FS_CIP)
                             ),
                             array('title' =>'CIP.NET.UA', 'link' => tep_href_link('http://cip.net.ua/')),
                             array('title' =>BOX_CONTRIB_INSTALLER_SEARCH_CIP, 'link' => tep_href_link('http://cip.net.ua/catalog/admin/cip_manager.php')),
                        )
                )
);
]]></replace>
    </findreplace>
<!-- e on index.php -->






<!--
    <sql>
        <query><![CDATA[
        CREATE TABLE IF NOT EXISTS  `contrib_installer_tags` (
`cip_id` int(5) NOT NULL PRIMARY KEY,
`tag_id` int(5) NOT NULL,
`tag_name` varchar(25) NULL,
`file_name` varchar(255) NULL,
`start` tinyint unsigned NULL,
`end` tinyint unsigned NULL,
`type` char(5) NULL,
`find`  text NULL,
`replace` text NULL,
`add` text NULL,
`install` text NULL,
`remove` text NULL,
`parent_dir_name` varchar(255) NULL,
`dir_name` varchar(255) NULL,
`query` text NULL,
`remove_query` text NULL,
`code_type` char(4) default 'php'
);
        ]]></query>
        <remove_query>DROP TABLE IF EXISTS `contrib_installer_tags`;</remove_query>
    </sql>
-->


<!--

    <sql>
        <query><![CDATA[
        CREATE TABLE IF NOT EXISTS  contrib_installer_files_integrity (
            `path_md5` char(32) NOT NULL default '',
            `content_md5` char(32) NOT NULL default '',
            `modification_date` datetime,
            `contrib` varchar(100) NOT NULL default '',
            `path` varchar(255) NOT NULL default ''
        );
        ]]></query>
        <remove_query>DROP TABLE IF EXISTS `contrib_installer_files_integrity`;</remove_query>
    </sql>




    <sql>
        <query><![CDATA[
        INSERT INTO `installed_contributions_type` VALUES (1,'Credit Modules',1),(1,'Features',1), (1,'Images',1),
        (1,'InfoBoxes',1),(1,'Languages',1),(1,'Order Total Modules',1),(1,'Payment Modules',1),(1,'Reports',1),
        (1,'Shipping Modules',1),(1,'Templates / Themes',1),(1,'Other',1),(1,'Zones',1),(1,'Bookmarks',1);
        ]]></query>
        <remove_query>SELECT * FROM `configuration_group` WHERE 1=0;</remove_query>
    </sql>

-->
</contrib>